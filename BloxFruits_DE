local plrs, plr, h1, h2, plr_pos, plr_health, tweenspeed, ts, crtw
local tweening_table
local currentTween = nil
local previousUsername = nil

plrs = game:GetService("Players")
ts = game:GetService("TweenService")
plr = plrs.LocalPlayer
h1 = plr.Character.Humanoid
h2 = plr.Character.HumanoidRootPart
plr_pos = h2.Position
plr_health = h1.Health
tweenspeed = 250

tweening_table = {"-goto", "-moveto", "-to", "-flyto"}

function autocorrect_players(input)
    for _, player in ipairs(plrs:GetPlayers()) do
        if string.lower(player.Name):sub(1, #input) == string.lower(input) or
        string.lower(player.DisplayName):sub(1, #input) == string.lower(input) then
            return player
        end
    end
    return nil
end

function ct_duration(spos, epos, spd)
    local di = (epos - spos).magnitude
    return di / spd
end

function ct_info(spos, epos)
    local du = ct_duration(spos, epos, tweenspeed)
    return TweenInfo.new(du, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
end

function cancel_current_tween()
    if currentTween and currentTween.Playing then
        currentTween:Cancel()
    end
end

function DE_Commands(message)
    local feather = string.split(message, " ")
    
    if table.find(tweening_table, feather[1]) then
        if #feather == 2 then
            local specific_u = feather[2]
            local c_specific = autocorrect_players(specific_u)
            
            if c_specific then
                local target_player = c_specific
                local target_humanoidRootPart = target_player.Character and target_player.Character:FindFirstChild("HumanoidRootPart")
                
                if target_humanoidRootPart then
                    local target_position = target_humanoidRootPart.Position + Vector3.new(0, 1, 0)
                    local plr_humanoidRootPart = plr.Character:FindFirstChild("HumanoidRootPart")

                    if plr_humanoidRootPart then
                        cancel_current_tween()

                        previousUsername = specific_u

                        local duration = ct_duration(plr_humanoidRootPart.Position, target_position, tweenspeed)

                        local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
                        
                        local goal = {CFrame = CFrame.new(target_position)}
                        currentTween = ts:Create(plr_humanoidRootPart, tweenInfo, goal)
                        
                        currentTween:Play()

                        currentTween.Completed:Connect(function()
                            previousUsername = nil
                            currentTween = nil
                        end)
                    end
                end
            end
        end
    end
end

plr.CharacterAdded:Connect(function()
    wait(2)
    plr.Chatted:Connect(DE_Commands)
end)

plr.Chatted:Connect(DE_Commands)
